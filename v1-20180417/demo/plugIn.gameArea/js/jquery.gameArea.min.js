(function($){
	$.fn.tabs = function(options){
		var defaults = {
			"type" : "1",		//1端游，2手游，3页游
			"role" : "false",	//是否是多角色游戏
			"txt" : "提示文字",	//提示文字
			"list" : "",		//数据表，默认空
			"maxNum" : 10, 		//每间隔最大，默认10
			"searchWrong" : "你搜索的大区不存在",
			"searchImg" : "http://whj.fayfox.com/img/ic_search.png" //搜索图片
		},

		options = $.extend(defaults,options),

		objs = {
			"selA" : $("<div>").addClass("u_selArea_a"),
			"selATxt" : $("<label>").addClass("u_selArea_aTxt").html(options["txt"]),
			"selB" : $("<div>").addClass("u_selArea_b"),
			"selBTab" : $("<div>").addClass("u_selArea_bTab"),
			"selBSearch" : $("<div>").addClass("u_selArea_bSearch").append("<input type=\"text\"/><img src=\""+ options["searchImg"]+"\"/>"),
			"selBSearchTips" : $("<div>").addClass("u_selArea_bSearchTips").html(options["searchWrong"]),
			"selBList" : $("<ul>").addClass("u_selArea_bList"),
			"rememberInp" : $("<input type=\"hidden\" data-tip=\"#J_changeAreaTip\" name=\"areaId\">")
		},

		domName = this,

		dfunc = {

			init : function(options, objs){
				
				var _t = this;

				_t.V.getDoms(options, objs);
				_t.M.even(options, objs)

			},

			V : {

				getDoms : function(options, objs){

					var _t = this; 
					objs["selA"].append(objs["selATxt"]);
					objs["selA"].append("<i class=\"ic_down\"></i>");
					if(options["type"]=="2"){
						objs["selB"].append(objs["selBTab"]);
						objs["selB"].append(objs["selBSearchTips"]);
					}
					objs["selB"].append(objs["selBList"]);

					objs["selBList"].append(_t.domArea(options, objs));
					objs["selBTab"].append(dfunc.M.tabCount(dfunc.M.allLen,options));
					objs["selBTab"].append(objs["selBSearch"]);

					domName.addClass("u_selArea");
					domName.append(objs["selA"]);
					domName.append(objs["selB"]);
					domName.append(objs["rememberInp"]);
				},

				domArea : function(options, objs){

					var dom = "",
						list = dfunc.M.resetList(options["list"]);

					$.each(list, function(k,d){

						if(parseInt(k)){

							$.each(d,function(v,n){
								dom += "<li data-val=\""+v+"\" data-other=\"0\">"+n["name"]+"</li>";
								dfunc.M.allLen++;
							});
						} else {
							//测试区等没有数字在的大区
							$.each(d,function(v,n){
								dom += "<li data-val=\""+v+"\" data-other=\"1\">"+n["name"]+"</li>";
								dfunc.M.otherLen = true;
							});
						}
						
					});
					return dom;
				}
			},

			M : {

				allLen : 0,	//列表长度
				otherLen : false, //是否存在测试区 默认不存在
				even : function(options, objs){

					var _t = this,
						searchVal = "";

					//出现下拉
					objs["selA"].click(function(){
						if(!$(this).attr("data-boo")){
							objs["selBList"].find("li").hide();
							objs["selBTab"].find("li:eq(0)").addClass("crt").css("border-left","0");
							objs["selBList"].find("li:lt("+options["maxNum"]+")").show();
							$(this).attr("data-boo",1);
						};
						domName.css("z-index","99");
						objs["selB"].slideDown(100);
						return false;
					})

					//tab 切换
					objs["selBTab"].find("li").mouseenter(function(){
						var txt = $(this).text(), gtNum =0, ltNum=0;

						$(this).addClass("crt").siblings().removeClass("crt");
						objs["selBSearch"].find("input").val("");

						if(txt == "其他"){
							objs["selBList"].find("li[data-other=\"0\"]").hide();
							objs["selBList"].find("li[data-other=\"1\"]").show();
						} else {
							gtNum = $(this).text().split("-")[0]-2,
							ltNum = $(this).text().split("-")[1];

							objs["selBList"].find("li").hide();

							if(gtNum < 0){
								objs["selBList"].find("li:lt("+ltNum+")").show();
							} else {
								objs["selBList"].find("li:lt("+ltNum+"):gt("+gtNum+")").show();
							}
						}

					});
					objs["selBTab"].find("li").click(function(){
						return false;
					})

					//search
					objs["selBSearch"].click(function(){
						searchVal = objs["selBSearch"].find("input").val();
						_t.searchFun(objs,searchVal);
						return false;
					});
					objs["selBSearch"].find("input").keyup(function(){
						searchVal = $(this).val();
						_t.searchFun(objs,searchVal);
						return false;
					});

					//areaList
					objs["selBList"].find("li").click(function(){
						var liName = $(this).text(),
							liId = $(this).attr("data-val");
						objs["selATxt"].text(liName);
						objs["rememberInp"].val(liId).attr("data-Name",liName);

					});

					//body
					$("body").click(function(){
						domName.css("z-index","1");
						objs["selB"].hide();
					})
				},

				searchFun : function(objs,searchVal){
					var i = 0;

					objs["selBTab"].find("li").removeClass("crt");

					objs["selBList"].find("li").each(function(){
						if($(this).text().indexOf(searchVal) > -1){
							$(this).show();
							i++;
						} else {
							$(this).hide();
						}
					});
					if(i < 1){
						objs["selBSearchTips"].show();
					} else {
						objs["selBSearchTips"].hide();
					}
				},

				resetList : function(list){
					var _t = this, mainList = {}, num = 0, areaId = "";
					$.each(list ,function(k,d){
						num = d["name"].split(" ")[0];
						mainList[num] = {};
						mainList[num][k] = d;
					});
					return mainList;
				},

				tabCount : function(len,options){
					var _t = this, liLen = Math.ceil(len/options["maxNum"]),
						i = 0,
						liDom = "<ul>";
					for(; i < liLen; i++){
						liDom += "<li>"+(i*15+1)+"-"+(i+1)*15+"</li>";
					};
					if(_t.otherLen === true){
						liDom += "<li>其他</li>";
					};
					liDom+="</ul>";
					return liDom;
				}
			}
		};

		dfunc.init(options, objs);
	}
})(jQuery)